### ***
### WARNING: DO NOT manually EDIT or MERGE this file, it is generated by 'make ci-config'.
### INSTEAD: Edit or merge the source in config/ then run 'make ci-config'.
### ***
version: 2
jobs:
  lint-go:
    machine: true
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"
          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: make lint
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.5546
    - GO_TAGS: ''
    - GO_VERSION: 1.14
    - GO111MODULE: 'on'
    - GOTESTSUM_VERSION: 0.3.3
  test-go:
    machine: true
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"
          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: make test
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.5546
    - GO_TAGS: ''
    - GO_VERSION: 1.14
    - GO111MODULE: 'on'
    - GOTESTSUM_VERSION: 0.3.3
  build-go:
    machine: true
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"
          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: make build
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.5546
    - GO_TAGS: ''
    - GO_VERSION: 1.14
    - GO111MODULE: 'on'
    - GOTESTSUM_VERSION: 0.3.3
workflows:
  ci:
    jobs:
    - lint-go
    - test-go
    - build-go
  version: 2

# Original config.yml file:
# commands:
#   install-go:
#     description: |
#       Ensure the right version of Go is installed and set GOPATH to $HOME/go.
#     steps:
#     - run:
#         command: |
#           [ -n \"$GO_VERSION\" ] || { echo \"You must set GO_VERSION\"; exit 1; }
#           # Install Go
#           curl -sSLO \"https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz\"
#           sudo rm -rf /usr/local/go
#           sudo tar -C /usr/local -xzf \"go${GO_VERSION}.linux-amd64.tar.gz\"
#           rm -f \"go${GO_VERSION}.linux-amd64.tar.gz\"
#           GOPATH=\"/go\"
#           mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
#           echo \"export GOPATH='$GOPATH'\" >> \"$BASH_ENV\"
#           echo \"export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'\" >> \"$BASH_ENV\"
#           echo \"$ go version\"
#           go version
#         name: Setup Go
#         working_directory: ~/
# executors:
#   go:
#     environment:
#       CIRCLECI_CLI_VERSION: 0.1.5546
#       GO_TAGS: \"\"
#       GO_VERSION: 1.14
#       GO111MODULE: \"on\"
#       GOTESTSUM_VERSION: 0.3.3
#     machine: true
#     shell: /usr/bin/env bash -euo pipefail -c
#     working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
# jobs:
#   build-go:
#     executor: go
#     steps:
#     - install-go
#     - checkout
#     - run: make build
#   lint-go:
#     executor: go
#     steps:
#     - install-go
#     - checkout
#     - run: make lint
#   test-go:
#     executor: go
#     steps:
#     - install-go
#     - checkout
#     - run: make test
# version: 2.1
# workflows:
#   ci:
#     jobs:
#     - lint-go
#     - test-go
#     - build-go