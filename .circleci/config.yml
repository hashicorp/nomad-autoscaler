### ***
### WARNING: DO NOT manually EDIT or MERGE this file, it is generated by 'make ci-config'.
### INSTEAD: Edit or merge the source in config/ then run 'make ci-config'.
### ***
version: 2
jobs:
  lint-go:
    docker:
    - image: docker.mirror.hashicorp.services/golang:1.15.2
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          rm -rf /usr/local/go
          tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"
          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: make lint-tools
    - run:
        command: make generate-tools
    - run:
        command: make lint
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.6772
    - GO_TAGS: ''
    - GO_VERSION: 1.15.2
    - GO111MODULE: 'on'
  check-deps-go:
    docker:
    - image: docker.mirror.hashicorp.services/golang:1.15.2
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          rm -rf /usr/local/go
          tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"
          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: make generate-tools
    - run:
        command: make check
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.6772
    - GO_TAGS: ''
    - GO_VERSION: 1.15.2
    - GO111MODULE: 'on'
  test-go:
    docker:
    - image: docker.mirror.hashicorp.services/golang:1.15.2
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          rm -rf /usr/local/go
          tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"
          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: make test-tools
    - run:
        command: make test
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.6772
    - GO_TAGS: ''
    - GO_VERSION: 1.15.2
    - GO111MODULE: 'on'
  build-go:
    docker:
    - image: docker.mirror.hashicorp.services/golang:1.15.2
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          rm -rf /usr/local/go
          tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"
          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: make build
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.6772
    - GO_TAGS: ''
    - GO_VERSION: 1.15.2
    - GO111MODULE: 'on'
workflows:
  ci:
    jobs:
    - lint-go
    - check-deps-go
    - test-go
    - build-go
  version: 2

# Original config.yml file:
# commands:
#     install-go:
#         description: |
#             Ensure the right version of Go is installed and set GOPATH to $HOME/go.
#         steps:
#             - run:
#                 command: |
#                     [ -n \"$GO_VERSION\" ] || { echo \"You must set GO_VERSION\"; exit 1; }
#                     # Install Go
#                     curl -sSLO \"https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz\"
#                     rm -rf /usr/local/go
#                     tar -C /usr/local -xzf \"go${GO_VERSION}.linux-amd64.tar.gz\"
#                     rm -f \"go${GO_VERSION}.linux-amd64.tar.gz\"
#                     GOPATH=\"/go\"
#                     mkdir $GOPATH 2>/dev/null || { chmod 777 $GOPATH; }
#                     echo \"export GOPATH='$GOPATH'\" >> \"$BASH_ENV\"
#                     echo \"export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'\" >> \"$BASH_ENV\"
#                     echo \"$ go version\"
#                     go version
#                 name: Setup Go
#                 working_directory: ~/
# executors:
#     go:
#         docker:
#             - image: docker.mirror.hashicorp.services/golang:1.15.2
#         environment:
#             CIRCLECI_CLI_VERSION: 0.1.6772
#             GO_TAGS: \"\"
#             GO_VERSION: 1.15.2
#             GO111MODULE: \"on\"
#         shell: /usr/bin/env bash -euo pipefail -c
#         working_directory: /go/src/github.com/hashicorp/nomad-autoscaler
# jobs:
#     build-go:
#         executor: go
#         steps:
#             - install-go
#             - checkout
#             - run: make build
#     check-deps-go:
#         executor: go
#         steps:
#             - install-go
#             - checkout
#             - run: make generate-tools
#             - run: make check
#     lint-go:
#         executor: go
#         steps:
#             - install-go
#             - checkout
#             - run: make lint-tools
#             - run: make generate-tools
#             - run: make lint
#     test-go:
#         executor: go
#         steps:
#             - install-go
#             - checkout
#             - run: make test-tools
#             - run: make test
# version: 2.1
# workflows:
#     ci:
#         jobs:
#             - lint-go
#             - check-deps-go
#             - test-go
#             - build-go